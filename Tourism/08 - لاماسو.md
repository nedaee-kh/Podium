# لاماسو

این سرویس، اتاق‌های قابل رزرو هتل‌ها و نرخ‌‌های ارائه‌شده برای هر کدام را مستقیماً برای آژانس‌های مسافرتی و مراکز رزرو دهنده آنلاین، به‌روزرسانی می‌کند. با این کار، رزرو اتاق به آسانی و با سرعت و دقت بیشتری صورت می‌گیرد و از بروز مشکلاتی مثل پذیرش بیش از ظرفیت جلوگیری می‌شود.
هتل‌ها و مراکز اقامتی با استفاده از این سرویس، می‌توانند به مراکز رزرودهنده و آژانس‌های مسافرتی متصل شوند. این سرویس زیرساختی برای ارائه‌ی اطلاعات هتل‌ها به صورت یک‌پارچه است تا کارگزاران و فروشندگان بتوانند اطلاعات هتل‌های خود را به رزرو کننده‌های زیادی ارائه کنند.
<div class="box-end">
</div>

## دریافت شهرها

این متد برای دریافت لیست جست و جوی شهر‌های ثبت شده در سیستم و برای استفاده‌های آتی قابل استفاده است.

لازم به ذکر است با توجه به عدم ثبت همه شهرهای ایران با کد استاندارد جهانی، شهرهایی که کد IATA داشته اند از همان استفاده شده است.

    HEADER:
        Authorization=[api-key]
    Method:
        GET
    Url:
        [base-url]/booking/cities
        شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10707

+ **توجه:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را  ارسال نمائید.

<div class="box-end">
</div>

## دریافت قوانین

در این متد سیاست‌های فروش و محدودیت های فروش و شرایط قراردادی برای هتل‌ها برای شما ارسال خواهد شد.

    HEADER:
        Authorization=[api-key]
    Method:
        GET
    Url:
        [base-url]/booking/policies

شماره محصول برای فراخوانی به صورت سرویس کال: productId = xxxxx

+ **توجه:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را  ارسال نمائید.


<div class="box-end">
</div>

## دریافت امکانات

این متد با هدف ایجاد جدول جست و جو برای سامانه مشتری قرار گرفته است. برای دریافت این اطلاعات تنها نیاز است به آدرس مورد نظر درخواست ارسال شود. در پاسخ برای شما مجموعه‌ای از امینیتی‌ها ارسال خواهد شد که شامل نام و شناسه و نوع خواهد بود.نوع نشان دهنده این است که این امینیتی مربوط به هتل بوده یا اتاق.

    HEADER:
        Authorization=[api-key]
    Method:
        GET
    Url:
        [base-url]/booking/amenities

شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10706

+ **توجه 1:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را مطابق توضیحات نحوه استفاده از سرویس کال پاد ارسال نمائید.
+ **توجه 2:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، مقدار هر یک از پارامترهای فوق را با استفاده از paramNames و paramValues ارسال نمائید. 
<div class="box-end">
</div>

## دریافت اطلاعات اولیه هتل‌ها

این متود برای دریافت لیست هتل ها و جزییات مربوط به هرکدام از آنها استفاده میشود لیست مربوط به هتل ها با توجه  به apiKey مربوط به آژانس مورد نظر 

    HEADER:
            Authorization = [api-key]
    Method: GET
    Url:
            [base-url]/booking/hotel_inventory

شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10705
<div class="box-end">
</div>

## موجودی هتل

با استفاده از این روش و با وارد کردن آی دی هتل و تاریخ ورود و تاریخ خروج موجودی هتل نمایش داده خواهد شد.

در این روش می‌توان اطلاعات بیش از یک هتل را درخواست کرد.

لازم به ذکر است در بدنه درخواست و در فیلد hotel_ids مجموعه شناسه‌ها باید در قالب یک آرایه ارسال گردند. 

پارامترها با ملاحظات زیر باید در بدنه درخواست قرار بگیرند:

    HEADER:
            Authorization= [api-key]

    Method: POST
    Url:
            [base-url]/booking/hotel_availability
    Parameters:
            hotel_ids=                   //hotel ids from https://api.lamasoo.com/docs/#/Static/HotelInventoryGet
            start_date=                 //check-in date for the reservation
            end_date=                  //check-out date for the reservation
            lang=                       //ISO 3166-1 alpha-2
            currency=                  //ISO 4217
            user_country=             //ISO 3166-1 alpha-2 country code.

شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10710

+ **توجه 1:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را مطابق توضیحات نحوه استفاده از سرویس کال پاد ارسال نمائید.
+ **توجه 2:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، مقدار هر یک از پارامترهای فوق را با استفاده از paramNames و paramValues ارسال نمائید. 
<div class="box-end">
</div>

## موجود بودن اتاق برای رزرو

با استفاده از متد اطلاعات موجودی یک هتل در یک تاریخ مشخص با جزئیات قیمت و نر‌خ‌نامه و ظرفیت و قیمت نفر اضافه بدست می‌آید. 

در این متد شناسه هتل نباید به صورت آرایه ارسال گردد. این متد تنها شناسه یک هتل را به عنوان ورودی دریافت می‌کند.

شناسه هتل مورد نظر باید از داده‌های Hotel_Inventory برداشته شود.

پارامترها با ملاحظات زیر باید در بدنه درخواست قرار بگیرند:

```
HEADER:
        Authorization= [api-key]

Method: POST
Url:
        [base-url]//booking/booking_availability
Parameters:
        hotel_id=                    //hotel id
        start_date=                 //check-in date for the reservation
        end_date=                  //check-out date for the reservation
        lang=                       //ISO 3166-1 alpha-2
        currency=                  //ISO 4217
        user_country=             //ISO 3166-1 alpha-2 country code.
```


شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10711

+ **توجه 1:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را مطابق توضیحات نحوه استفاده از سرویس کال پاد ارسال نمائید.
+ **توجه 2:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، مقدار هر یک از پارامترهای فوق را با استفاده از paramNames و paramValues ارسال نمائید. 
<div class="box-end">
</div>

## ثبت اولیه رزرو

این متد برای ثبت رزرو اولیه و برای قفل کردن اتاق برای ثبت نهایی استفاده می‌شود. این متد ۱۵ دقیقه اتاق را در هتل قفل و برای شخصی که در این درخواست ارائه می‌شود در هتل محفوظ نگه‌ میدارد.

در این متد نکته مهم رفرنس آی-دی خواهد بود که رزرو کننده باید این کد را در بدنه درخواست ارسال نماید. این کد باید برای همان رزرو دهنده یکتا باشد و برای پیگیری های آتی قابل استفاده است.

در این درخواست نکته مهم ثبت آبجکت‌های رزرو مطابق مثال خواهد بود.

برای ثبت چند اتاق (از انواع متفاوت و یا از یک نوع) باید در آبجکت‌های مختلف و با تعیین تعداد نفرات بزرگسال و کودک در همان اتاق انجام پذیرد.

در صورت مغایرت حداکثر تعداد نفرات اضافه در هر اتاق با خطا مواجه خواهید شد. اطلاعات مربوط به ظرفیت و ظرفیت نفر اضافه و شناسه هتل و شناسه اتاق‌های هر اتاق در پاسخ متد booking availablity و یا hotels/hotel inventory به شما برخواهد گشت.

در این متد نام شخصی که برای ثبت رزرو در بدنه ارسال می‌شود در هتل ثبت خواهد شد.

تعداد کودک در هر اتاق باید به صورت یک آرایه از سن کودکان هر اتاق ثبت شود ولی تعداد نفرات بزرگسال در هر اتاق به صورت یک عدد قابل ثبت است.

در این متد rate_plan_id باید مانند موارد ظرفیت و شناسه هتل در پاسخ booking availablity برای رزرو دهنده ارسال شده است.

این آی دی برای هر هتل می‌تواند مقادیر متفاوتی داشته باشد. در بازه‌‌های زمانی متفاوت تغییر کند. این شناسه نشان‌دهنده نرخ‌نامه هر قیمت خواهد بود به طور مثال هتل برای آژانس الف نرخنامه تابستان را در دسترس قرار داده و مثلا آی دی این نرخنامه 1721 خواهد بود

این شناسه ممکن است به صورت عددی و یا ترکیبی از هر دو باشد.

در حال حاضر تناظری بین ‌‌شناسه های هتل های متفاوت وجود ندارد.

در انتها، بدنه این متد دارای ورودی payment_method است که از بین روش ‌‌های پرداخت مختلف ممکن برای رزرو دهنده حالت‌های متفاوتی ارائه شده.

در اکثر موارد متد پرداخت pod_credit باید استفاده شود که آی دی این متد : 5ac8dce63dbd6c97c69b3746 می باشد.

در پاسخ این متد به شما در صورت ثبت موفق رفرنس آی دی و مبلغ ثبت رزرو و شماره فاکتوری که باید توسط رزرو کننده در پاد پرداخت شود (توسط متد pay_invoice_by_id) که در پاد و وب‌سرویس‌های پاد در دسترس است.

و در صورت بروز خطا، خطای مربوطه به شما ارائه خواهد شد.

```
HEADER:
        Authorization= [api-key]
Method: POST
Url:
        [base-url]/booking/booking_submit/
Parameters:
        checkin_date=            //checkin date of passenger
        checkout_date=          //checkout date of passenger
        hotel_id=                  //hotel id from previous method's response
        reference_id=            //better generated by client side, if it is not sent by client it should generated by Lamasoo and  you receive it in response of submit
        payment_method=      //to pay by POD platform should set "5ac8dce63dbd6c97c69b3746"
        customer=
            first_name=                //first name of passenger or POD user
            last_name=                //last name of passenger or POD user
            national_code=            //national id of passenger or POD user
            phone_number=           //phone number of passenger or POD user
            country=                   //ISO 3166-1 alpha-2 country code and should be the passenger nationality
         rooms=                       
            type_id=                   //from booking_availablity method's response
            count=                     //number of each room type needed
            party=
```


شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10712

+ **توجه 1:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را مطابق توضیحات نحوه استفاده از سرویس کال پاد ارسال نمائید.
+ **توجه 2:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، مقدار هر یک از پارامترهای فوق را با استفاده از paramNames و paramValues ارسال نمائید. 
<div class="box-end">
</div>

## بررسی رزرو

این متد برای پیگیری‌های آتی قابل استفاده است.

برای استفاده از این متد باید کد رفرنسی که پیش از این در متد submit و confirm در فیلد refrence_id تبادل شده است و hotel_id ارسال شود.

در پاسخ وضعیت رزرو مورد درخواست در سه حالت ناشناخته و تایید شده و ناموفق به شما ارسال می‌شود.

درحالت ناشناخته به صورت کلی مشکل از refrence_id بوده‌است.

```
HEADER:
        Authorization= [api-key]

Method: POST
Url:
        [base-url]//booking/booking_verify
Parameters:
        hotel_id=                    // hotel id
        reference_id=              // reference_id should be the same value in the submit api
```


شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10713

+ **توجه 1:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را مطابق توضیحات نحوه استفاده از سرویس کال پاد ارسال نمائید.
+ **توجه 2:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، مقدار هر یک از پارامترهای فوق را با استفاده از paramNames و paramValues ارسال نمائید. 
<div class="box-end">
</div>

## تائید رزرو

بعد از استفاده از متد submit که رزرو را تا مدت معین محفوظ نگه‌ خواهد داشت، متد کانفرم بر اساس اطلاعاتی که در متد submit ارسال شده پردازش خواهد شد.

به طور مثال اگر متد پرداختی نقدی و یا از اعتبار پاد را در submit انتخاب کرده باشید باید قبل از کانفرم پرداخت انجام گرفته باشد و پس از آن می‌توانید با استفاده از refrence_id و hotel_id این متد را فراخوانی کنید. در پاسخ با توجه به این موارد برای شما ارسال می‌گردد.

لازم به ذکر است این متد در صورتی که بیش از زمان معین از ثبت اولیه (submit) گذشته باشد قابل استفاده نیست با خطا مواجه خواهد شد.`
``

    HEADER:
            Authorization =[api-key]

    Method: POST
    Url:
            [base-url]/booking/booking_confirm
    Parameters:
            hotel_id=              //hotel id
            reference_id=        //refrence id which used in booking submit method

`
شماره محصول برای فراخوانی به صورت سرویس کال: productId = 10714

+ **توجه 1:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، نیازی به ارسال هدر Authorization نیست و شما بایستی پارامتر serviceCallToken را مطابق توضیحات نحوه استفاده از سرویس کال پاد ارسال نمائید.
+ **توجه 2:** در فراخوانی متد فوق بصورت سرویس کال و از طریق پاد، مقدار هر یک از پارامترهای فوق را با استفاده از paramNames و paramValues ارسال نمائید. 

<div class="box-end">
</div>
